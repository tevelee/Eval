<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Eval  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="Eval  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">Eval Docs</a> (99% documented)</p>
        <p class="header-right"><a href="https://github.com/tevelee/Eval"><img src="img/gh.png"/>View on GitHub</a></p>
        <p class="header-right"><a href="dash-feed://https%3A%2F%2Ftevelee%2Egithub%2Eio%2Fdocsets%2FEval%2Exml"><img src="img/dash.png"/>Install in Dash</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">Eval Reference</a>
        <img id="carat" src="img/carat.png" />
        Eval  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Guides.html">Guides</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="example-projects.html">Example projects</a>
              </li>
              <li class="nav-group-task">
                <a href="interpreter-engine-details.html">Interpreter engine details</a>
              </li>
              <li class="nav-group-task">
                <a href="strongly-typed-evaluator.html">Strongly-typed evaluator</a>
              </li>
              <li class="nav-group-task">
                <a href="template-evaluator.html">Template evaluator</a>
              </li>
              <li class="nav-group-task">
                <a href="tips--tricks.html">Tips &amp; Tricks</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/CloseKeyword.html">CloseKeyword</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Context.html">Context</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DataType.html">DataType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Function.html">Function</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/GenericVariable.html">GenericVariable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Keyword.html">Keyword</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Keyword/KeywordType.html">‚Äì KeywordType</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Literal.html">Literal</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Matcher.html">Matcher</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/OpenKeyword.html">OpenKeyword</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Pattern.html">Pattern</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StringTemplateInterpreter.html">StringTemplateInterpreter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TemplateInterpreter.html">TemplateInterpreter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TemplateVariable.html">TemplateVariable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TypedInterpreter.html">TypedInterpreter</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes.html#/s:4Eval8VariableC">Variable</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/VariableProcessor.html">VariableProcessor</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/MatchResult.html">MatchResult</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Eval1poiySayAA14PatternElement_pGAaC_p_AaC_ptF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Eval1poiySayxGAC_xtlF">+(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Eval2peoiyySayxGz_xtlF">+=(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Eval22collectConnectedRanges5input10statementsSaySNySS5IndexVGGSS_SayAA7PatternCyypAA16TypedInterpreterCGGtF">collectConnectedRanges(input:statements:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:4Eval14matchStatement7amongst2in4from11interpreter7context15connectedRangesAA11MatchResultOyxGSayAA7PatternCyxq_GG_S2S5IndexVSgq_AA7ContextCSaySNyAQGGtAA11InterpreterR_r0_lF">matchStatement(amongst:in:from:interpreter:context:connectedRanges:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/DataTypeProtocol.html">DataTypeProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Evaluator.html">Evaluator</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/EvaluatorWithLocalContext.html">EvaluatorWithLocalContext</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/FunctionProtocol.html">FunctionProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Interpreter.html">Interpreter</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PatternElement.html">PatternElement</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/PatternProtocol.html">PatternProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/Printer.html">Printer</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/VariableProcessorProtocol.html">VariableProcessorProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/VariableProtocol.html">VariableProtocol</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/DataTypeBody.html">DataTypeBody</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ExpressionInfo.html">ExpressionInfo</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/LiteralBody.html">LiteralBody</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PatternBody.html">PatternBody</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/PatternOptions.html">PatternOptions</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VariableBody.html">VariableBody</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/VariableOptions.html">VariableOptions</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4Eval12MatcherBlocka">MatcherBlock</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:4Eval13VariableValuea">VariableValue</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='eval' class='heading'>{ Eval }</h1>

<p><a href="https://travis-ci.org/tevelee/Eval"><img src="https://travis-ci.org/tevelee/Eval.svg?branch=master" alt="Travis CI status"></a>
<a href=""><img src="https://img.shields.io/badge/Version-1.5.0-yellow.svg" alt="Framework version"></a>
<a href=""><img src="https://img.shields.io/badge/Swift-5.0-orange.svg" alt="Swift version"></a>
<a href="https://tevelee.github.io/Eval"><img src="https://tevelee.github.io/Eval/badge.svg" alt="Code Documentation Coverage"></a>
<a href="https://codecov.io/gh/tevelee/Eval"><img src="https://codecov.io/gh/tevelee/Eval/branch/master/graph/badge.svg" alt="Code Test Coverage"></a>
<a href=""><img src="https://img.shields.io/badge/Platforms-iOS%20%7C%20macOS%20%7C%20Linux-blue.svg" alt="Platforms"></a>
<a href="https://github.com/tevelee/Eval/tree/master/LICENSE.txt"><img src="https://img.shields.io/badge/License-Apache%202.0-green.svg" alt="Lincese"></a></p>
<h5 id='dependency-managers' class='heading'>Dependency Managers</h5>

<p><a href="http://cocoapods.org/pods/Eval"><img src="https://img.shields.io/badge/CococaPods-Compatible-blue.svg" alt="CocoaPods compatible"></a>
<a href="https://github.com/apple/swift-package-manager"><img src="https://img.shields.io/badge/Swift%20Package%20Manager-Compatible-red.svg" alt="Swift Package Manager compatible"></a>
<a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-Compatible-brightgreen.svg?style=flat" alt="Carthage compatible"></a></p>

<hr>

<ul>
<li><a href="#-about">üë®üèª‚Äçüíª About</a></li>
<li><a href="#-getting-started">üìà Getting Started</a>

<ul>
<li><a href="#-short-example">ü§ì Short Example</a></li>
<li><a href="#%EF%B8%8F-installation">‚ö°Ô∏è Installation</a></li>
<li><a href="#%EF%B8%8F-how-does-it-work">‚ÅâÔ∏è How does it work?</a></li>
</ul></li>
<li><a href="#-status">üèÉüèª Status</a></li>
<li><a href="#-motivation">üí° Motivation</a></li>
<li><a href="#-examples">üìö Examples</a></li>
<li><a href="#-contribution">üôã Contribution</a></li>
<li><a href="#-details">üëÄ Details</a></li>
<li><a href="#-author">üë§ Author</a></li>
<li><a href="#%EF%B8%8F-license">‚öñÔ∏è License</a></li>
</ul>
<h2 id='about' class='heading'>üë®üèª‚Äçüíª About</h2>

<p><strong>Eval</strong> is a lightweight interpreter framework written in <img src="http://www.swiftapplications.com/wp-content/uploads/2016/04/swift-logo.png" width="16"> Swift, for üì±iOS, üñ• macOS, and üêßLinux platforms.</p>

<p>It evaluates expressions at runtime, with operators and data types you define.</p>

<table><thead>
<tr>
<th>üçè Pros</th>
<th>üçé Cons</th>
</tr>
</thead><tbody>
<tr>
<td>üê• Lightweight - the whole engine is really just a few hundred lines of code</td>
<td>ü§ì Creating custom operators and data types, on the other hand, can take a few extra lines - depending on your needs</td>
</tr>
<tr>
<td>‚úÖ Easy to use API - create new language elements in just a matter of seconds</td>
<td>‚ôªÔ∏è The evaluated result of the expressions must be strongly typed, so you can only accept what type you expect the result is going to be</td>
</tr>
<tr>
<td>üé¢ Fun - Since it is really easy to play with, it&rsquo;s joyful to add - even complex - language features</td>
<td>-</td>
</tr>
<tr>
<td>üöÄ Fast execution - I&rsquo;m trying to optimise as much as possible. Has its limitations though</td>
<td>üåß Since it is a really generic concept, some optimisations cannot be made, compared to native interpreters</td>
</tr>
</tbody></table>

<p>The framework currently supports two different types of execution modes:</p>

<ul>
<li><strong>Strongly typed expressions</strong>: like a programming language</li>
<li><strong>Template languages</strong>: evaluating expressions in arbitrary string environments</li>
</ul>

<p><em>Let&rsquo;s see just a few examples:</em></p>

<p>It&rsquo;s extremely easy to formulate expressions (and evaluate them at runtime), like </p>

<ul>
<li><code>5 in 1...3</code> evaluates to <code>false</code> Bool type</li>
<li><code>&#39;Eval&#39; starts with &#39;E&#39;</code> evaluates to <code>true</code> Bool type</li>
<li><code>&#39;b&#39; in [&#39;a&#39;,&#39;c&#39;,&#39;d&#39;]</code> evaluates to <code>false</code> Bool type</li>
<li><code>x &lt; 2 ? &#39;a&#39; : &#39;b&#39;</code> evaluates to <code>&quot;a&quot;</code> or <code>&quot;b&quot;</code> String type, based on the <code>x</code> Int input variable</li>
<li><code>Date(2018, 12, 13).format(&#39;yyyy-MM-dd&#39;)</code> evaluates to <code>&quot;2018-12-13&quot;</code> string</li>
<li><code>&#39;hello&#39;.length</code> evaluates to <code>5</code> Integer</li>
<li><code>now</code> evaluates to <code>Date()</code></li>
</ul>

<p>And templates, such as</p>

<ul>
<li><code>{% if name != nil %}Hello{% else %}Bye{% endif %} {{ name|default(&#39;user&#39;) }}!</code>, whose output is <code>Hello Adam!</code> or <code>Bye User!</code></li>
<li><code>Sequence: {% for i in 1...5 %}{{ 2 * i }} {% endfor %}</code> which is <code>2 4 6 8 10</code></li>
</ul>

<p>And so on&hellip; The result of these expressions depends on the content, determined by the evaluation. It can be any type which is returned by the functions (String, [Double], Date, or even custom types of your own.)</p>

<p>You can find various ways of usage in the examples section below.</p>
<h2 id='status' class='heading'>üèÉüèª Status</h2>

<ul>
<li>[x] Library implementation</li>
<li>[x] API finalisation</li>
<li>[x] Swift Package Manager support</li>
<li>[x] Initial documentation</li>
<li>[x] Example project (template engine)</li>
<li>[x] CocoaPods support</li>
<li>[x] CI</li>
<li>[x] Code test-coverage</li>
<li>[x] v1.0</li>
<li>[x] Fully detailed documentation</li>
<li>[x] Contribution guides</li>
<li>[x] Further example projects</li>
<li>[x] Debugging helpers</li>
<li>[x] v1.1</li>
</ul>

<p>This is a really early stage of the project, I&rsquo;m still deep in the process of all the open-sourcing related tasks, such as firing up a CI, creating a beautiful documentation page, managing administrative tasks around stability. </p>

<p>Please stay tuned for the updates!</p>
<h2 id='getting-started' class='heading'>üìà Getting started</h2>

<p>For the expressions to work, you&rsquo;ll need to create an interpreter instance, providing your data types and expressions you aim to support, and maybe some input variables - if you need any.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">interpreter</span> <span class="o">=</span> <span class="kt">TypedInterpreter</span><span class="p">(</span><span class="nv">dataTypes</span><span class="p">:</span> <span class="p">[</span><span class="n">number</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">boolean</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">date</span><span class="p">],</span>
                                   <span class="nv">functions</span><span class="p">:</span> <span class="p">[</span><span class="n">multipication</span><span class="p">,</span> <span class="n">addition</span><span class="p">,</span> <span class="n">ternary</span><span class="p">],</span>
                                   <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">(</span><span class="nv">variables</span><span class="p">:</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">]))</span>
</code></pre>

<p>And call it with a string expression, as follows.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="s">"2 * x + 1"</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Double</span>
</code></pre>
<h3 id='short-example' class='heading'>ü§ì Short example</h3>

<p>Let&rsquo;s check out a fairly complex example, and build it from scratch! Let&rsquo;s implement a language which can parse the following expression:</p>
<pre class="highlight swift"><code><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="p">?</span> <span class="mi">5</span> <span class="o">*</span> <span class="nv">x</span> <span class="p">:</span> <span class="n">pi</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre>

<p>There&rsquo;s a ternary operator <code>?:</code> in there, which we will need. Also, supporting number literals (<code>0</code>, <code>5</code>, and <code>1</code>) and boolean types (<code>true/false</code>). There&rsquo;s also a not equal operator <code>!=</code> and a <code>pi</code> constant. Let&rsquo;s not forget about the addition <code>+</code> and multiplication <code>*</code> as well!</p>

<p>First, here are the data types.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">numberLiteral</span> <span class="o">=</span> <span class="kt">Literal</span> <span class="p">{</span> <span class="n">value</span><span class="p">,</span><span class="n">_</span> <span class="k">in</span> <span class="kt">Double</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="c1">//Converts every number literal, if it can be represented with a Double instance</span>
<span class="k">let</span> <span class="nv">piConstant</span> <span class="o">=</span> <span class="kt">Literal</span><span class="p">(</span><span class="s">"pi"</span><span class="p">,</span> <span class="nv">convertsTo</span><span class="p">:</span> <span class="kt">Double</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">number</span> <span class="o">=</span> <span class="kt">DataType</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">Double</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">literals</span><span class="p">:</span> <span class="p">[</span><span class="n">numberLiteral</span><span class="p">,</span> <span class="n">piConstant</span><span class="p">])</span> <span class="p">{</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">trueLiteral</span> <span class="o">=</span> <span class="kt">Literal</span><span class="p">(</span><span class="s">"true"</span><span class="p">,</span> <span class="nv">convertsTo</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">falseLiteral</span> <span class="o">=</span> <span class="kt">Literal</span><span class="p">(</span><span class="s">"false"</span><span class="p">,</span> <span class="nv">convertsTo</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">boolean</span> <span class="o">=</span> <span class="kt">DataType</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">Bool</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">literals</span><span class="p">:</span> <span class="p">[</span><span class="n">trueLiteral</span><span class="p">,</span> <span class="n">falseLiteral</span><span class="p">])</span> <span class="p">{</span> <span class="nv">$0</span> <span class="p">?</span> <span class="s">"true"</span> <span class="p">:</span> <span class="s">"false"</span> <span class="p">}</span>
</code></pre>

<p>(The last parameter, expressed as a block, tells the framework how to formulise this type of data as a String for debug messages or other purposes)</p>

<p>Now, let&rsquo;s build the operators:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">multiplication</span> <span class="o">=</span> <span class="kt">Function</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"lhs"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Keyword</span><span class="p">(</span><span class="s">"*"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"rhs"</span><span class="p">))</span> <span class="p">{</span> <span class="n">arguments</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">lhs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"lhs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Double</span><span class="p">,</span> <span class="k">let</span> <span class="nv">rhs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"rhs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Double</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">addition</span> <span class="o">=</span> <span class="kt">Function</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"lhs"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Keyword</span><span class="p">(</span><span class="s">"+"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"rhs"</span><span class="p">))</span> <span class="p">{</span> <span class="n">arguments</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">lhs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"lhs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Double</span><span class="p">,</span> <span class="k">let</span> <span class="nv">rhs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"rhs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Double</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">+</span> <span class="n">rhs</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">notEquals</span> <span class="o">=</span> <span class="kt">Function</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"lhs"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Keyword</span><span class="p">(</span><span class="s">"!="</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"rhs"</span><span class="p">))</span> <span class="p">{</span> <span class="n">arguments</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">lhs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"lhs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Double</span><span class="p">,</span> <span class="k">let</span> <span class="nv">rhs</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"rhs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Double</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">!=</span> <span class="n">rhs</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">ternary</span> <span class="o">=</span> <span class="kt">Function</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">(</span><span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"condition"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Keyword</span><span class="p">(</span><span class="s">"?"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"true"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Keyword</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span> <span class="o">+</span> <span class="kt">Variable</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"false"</span><span class="p">))</span> <span class="p">{</span> <span class="n">arguments</span> <span class="k">in</span>
    <span class="k">guard</span> <span class="k">let</span> <span class="nv">condition</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s">"condition"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Bool</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="p">{</span>
        <span class="k">return</span>  <span class="n">arguments</span><span class="p">[</span><span class="s">"true"</span><span class="p">]</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span>  <span class="n">arguments</span><span class="p">[</span><span class="s">"false"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Looks like, we&rsquo;re all set. Let&rsquo;s evaluate our expression!</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">interpreter</span> <span class="o">=</span> <span class="kt">TypedInterpreter</span><span class="p">(</span><span class="nv">dataTypes</span><span class="p">:</span> <span class="p">[</span><span class="n">number</span><span class="p">,</span> <span class="n">boolean</span><span class="p">],</span>
                                   <span class="nv">functions</span><span class="p">:</span> <span class="p">[</span><span class="n">multipication</span><span class="p">,</span> <span class="n">addition</span><span class="p">,</span> <span class="n">notEquals</span><span class="p">,</span> <span class="n">ternary</span><span class="p">])</span>

<span class="k">let</span> <span class="nv">result</span> <span class="p">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="n">interpreter</span><span class="o">.</span><span class="nf">evaluate</span><span class="p">(</span><span class="s">"x != 0 ? 5 * x : pi + 1"</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">Context</span><span class="p">(</span><span class="nv">variables</span><span class="p">:</span> <span class="p">[</span><span class="s">"x"</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">]))</span>
<span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span> <span class="c1">//Pass!</span>
</code></pre>

<p>Now, that we have operators and data types, we can also evaluate anything using these data types:</p>

<ul>
<li><code>interpreter.evaluate(&quot;3 != 4&quot;) as Bool</code></li>
<li><code>interpreter.evaluate(&quot;2 + 1.5 * 6&quot;) as Double</code> (since multiplication is defined earlier in the array, it has a higher precedence, as expected)</li>
<li><code>interpreter.evaluate(&quot;true ? 1 : 2.5&quot;) as Double</code></li>
</ul>

<p>As you have seen, it&rsquo;s really easy and intuitive to build custom languages, using simple building blocks. With just a few custom data types and functions, the possibilities are endless. Operators, functions, string, arrays, dates&hellip;</p>

<p>The motto of the framework: Build your own (mini) language!</p>
<h3 id='installation' class='heading'>‚ö°Ô∏è Installation</h3>

<p>You have a few options to include the library in your app. </p>

<ul>
<li>Swift Package Manager</li>
<li>CocoaPods</li>
<li>Carthage</li>
<li>Manually</li>
</ul>
<h4 id='swift-package-manager' class='heading'>Swift Package Manager</h4>

<p>Just add the following line to your dependencies:</p>
<pre class="highlight swift"><code><span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/tevelee/Eval.git"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"1.5.0"</span><span class="p">),</span>
</code></pre>

<p>And reference it by name in your targets:</p>
<pre class="highlight swift"><code><span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
    <span class="o">.</span><span class="nf">target</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"MyAwesomeApp"</span><span class="p">,</span> <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"Eval"</span><span class="p">]),</span>
<span class="p">]</span>
</code></pre>

<p>And finally, run the integration command:</p>
<pre class="highlight shell"><code>swift package resolve
</code></pre>
<h4 id='cocoapods' class='heading'>CocoaPods</h4>

<p>Just add the following line to your <code>Podfile</code>:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'Eval'</span><span class="p">,</span> <span class="s1">'~&gt; 1.5.0'</span>
</code></pre>

<p>And install the new dependency:</p>
<pre class="highlight shell"><code>pod install
</code></pre>
<h4 id='carthage' class='heading'>Carthage</h4>

<p>Just add the following line to your <code>Cartfile</code>:</p>
<pre class="highlight ruby"><code><span class="n">github</span> <span class="s2">"tevelee/Eval"</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span>
</code></pre>

<p>And install the new dependency:</p>
<pre class="highlight shell"><code>carthage update
</code></pre>
<h4 id='manually' class='heading'>Manually</h4>

<p>(Not recommended! Please use a package manager instead to keep your dependencies up to date.)</p>

<p>Clone the repository content and copy the files into a new target in your app.</p>
<h3 id='how-does-it-work' class='heading'>‚ÅâÔ∏è How does it work?</h3>

<p>The interpreter itself does not define anything or any way to deal with the input string on its own. 
All it does is recognising patterns. </p>

<p>By creating data types, you provide literals to the framework, which it can interpret as an element or a result of the expression. 
These types are transformed to real Swift types.</p>

<p>By defining functions, you provide patterns to the framework to recognise. 
Functions are also typed, they return Swift types as a result of their evaluation.
Functions consist of keywords and variables, nothing more. </p>

<ul>
<li>Keywords are static strings which should not be interpreted as data (such as <code>if</code>, or <code>{</code>, <code>}</code>).</li>
<li>Variables, on the other hand, are typed values, recursively evaluated. For example, if a variable recognises something, that proves to be a further pattern, it recursively evaluates their body, until they find context-variables or literals of any given data type.</li>
</ul>

<p>Functions also have blocks, which provide the recognised variables in a key-value dictionary parameter, and you can do whatever you want with them: print them, convert them, modify or assign them to context-variables. </p>

<p>The addition function above, for example, consists of two variables on each side, and the <code>+</code> keyword in the middle. It also requires a block, where both sides are given in a <code>[String:Any]</code>, so the closure can get the values of the placeholders and add them together.</p>

<p>There&rsquo;s one interesting aspect of this solution: Unlike traditional - native - interpreters or compilers, this one recognises patterns from top to bottom. 
Meaning, that it looks at the input string, your expression, and recognises patterns in priority order, and recursively go deeper and deeper until the most basic expressions are met.</p>

<p>A traditional interpreter, however, parses expressions character by character, feeding the results to a lexer, the tokeniser, then builds up an abstract syntax tree (which is highly optimisable), and finally converts it to a binary (compiler) or evaluates it at runtime (interpreter), in one word: bottom-up.</p>

<p>The two solutions can be compared in various ways. The two main differences are in ease of use, and performance. 
This version of an interpreter provides an effortless way to define patterns, types, etc., but has its cost! It cannot parse as optimally as a traditional compiler could, as it doesn&rsquo;t have an internal graph of expressions (AST), but still performs in a much more than acceptable way.
Definition-wise, this framework provides an easily understandable way of language-elements, but the traditional one really lacks behind, because the lexer is usually an ugly, hardly understandable state machine, or regular expression, BAKED INTO the interpreter code itself.</p>
<h2 id='motivation' class='heading'>üí° Motivation</h2>

<p>I have another project, in which I&rsquo;m generating Objective-C and Swift model objects with loads of utils, based on really short templates. This project was not possible currently in Swift, as there is no template language - capable enough - to create my templates. (I ended up using a third party PHP framework, called <a href="https://github.com/twigphp/Twig">Twig</a>). So finally, I created one for Swift!</p>

<p>It turned out, that making it a little more generic - here and there - makes the whole thing really capable and flexible of using in different use-cases.</p>

<p>The pattern matching was there, but soon I realised, that I&rsquo;m going to need expressions as well, for printing, evaluating in if/while statements and so on. First, I was looking at an excellent library, <a href="https://github.com/nicklockwood/Expression">Expression</a>, created by Nick Lockwood, which is capable of evaluating numeric expressions. Unfortunately, I wanted a bit more, defining strings, dates, array, and further types and expressions, so I used my existing pattern matching solution to bring this capability to life.</p>

<p>It ended up quite positively after I discovered the capabilities of a generic solution like this. The whole thing just blew my mind, language features could have been defined in a matter of seconds, and I wanted to share this discovery with the world, so here you are :)</p>
<h2 id='examples' class='heading'>üìö Examples</h2>

<p>‚Äã
‚ÄãI included a few use-cases, which bring significant improvements on how things are processed before - at least in my previous projects.
‚Äã</p>
<h3 id='a-href-https-github-com-tevelee-eval-blob-master-examples-templateexample-tests-templateexampletests-templateexampletests-swift-template-language-a' class='heading'><a href="https://github.com/tevelee/Eval/blob/master/Examples/TemplateExample/Tests/TemplateExampleTests/TemplateExampleTests.swift">Template language</a></h3>

<p>I was able to create a full-blown template language, completely, using this framework and nothing else. It&rsquo;s almost like a competitor of the one I mentioned (<a href="https://github.com/twigphp/Twig">Twig</a>). This is the most advanced example of them all!</p>

<p>I created a standard library with all the possible operators you can imagine. With helpers, each operator is a small, one-liner addition. Added the important data types, such as arrays, strings, numbers, booleans, dates, etc., and a few functions, to be more awesome. <a href="https://github.com/tevelee/Eval/tree/master/Examples/TemplateExample/Sources/TemplateExample/TemplateExample.swift">Take a look for inspiration!</a></p>

<p>Together, it makes an excellent addition to my model-object generation project, and <strong>REALLY useful for server-side Swift development as well</strong>!</p>
<h3 id='a-href-https-github-com-tevelee-eval-blob-master-examples-attributedstringexample-tests-attributedstringexampletests-attributedstringexampletests-swift-attributed-string-parser-a' class='heading'><a href="https://github.com/tevelee/Eval/blob/master/Examples/AttributedStringExample/Tests/AttributedStringExampleTests/AttributedStringExampleTests.swift">Attributed string parser</a></h3>

<p>I created another small example, parsing attribtuted strings from simple expressions using XML style tags, such as bold, italic, underlined, colored, etc.</p>

<p>With just a few operators, this solution can deliver attributed strings from basic APIs, which otherwise would be hard to manage.</p>

<p>My connected project is an iOS application, using the Spotify <a href="https://github.com/spotify/HubFramework">HUB framework</a>, in which I can now provide rich strings with my view-models and parse them from the JSON string results.</p>
<h3 id='a-href-https-github-com-tevelee-eval-blob-master-examples-colorparserexample-tests-colorparserexampletests-colorparserexampletests-swift-color-parser-a' class='heading'><a href="https://github.com/tevelee/Eval/blob/master/Examples/ColorParserExample/Tests/ColorParserExampleTests/ColorParserExampleTests.swift">Color parser</a></h3>

<p>A color parser is also used by the BFF (Backend For Frontend, not üë≠) project I mentioned before. It can parse Swift Color objects from many different styles of strings, such as <code>#ffddee</code>, or <code>red</code>, or <code>rgba(1,0.5,0.4,1)</code>. I included this basic example in the repository as well.</p>
<h2 id='contribution' class='heading'>üôã Contribution</h2>

<p>Anyone is more than welcome to contribute to <strong>Eval</strong>! It can even be an addition to the docs or to the code directly, by <a href="https://github.com/tevelee/Interpreter/issues/new">raising an issue</a> or in the form of a pull request. Both are equally valuable to me! Happy to assist anyone!</p>

<p>In case you need help or want to report a bug - please file an issue. Make sure to provide as much information as you can; sample code also makes it a lot easier for me to help you. Check out the <a href="https://github.com/tevelee/Eval/tree/master/CONTRIBUTING.md">contribution guidelines</a> for further information. </p>

<p>I collected some use cases, and great opportunities for beginner tasks if anybody is motivated to bring this project to a more impressive state!</p>
<h2 id='details' class='heading'>üëÄ Details</h2>

<p>Please check out <a href="https://tevelee.github.io/Eval">https://tevelee.github.io/Eval</a> for the more detailed documentation pages!</p>
<h2 id='author' class='heading'>üë§ Author</h2>

<p>I am Laszlo Teveli, software engineer, iOS evangelist. In my free time I like to work on my hobby projects and open sourcing them üòâ</p>

<p>Feel free to reach out to me anytime via <code>tevelee [at] gmail [dot] com</code>, or <code>@tevelee</code> on Twitter.</p>
<h2 id='license' class='heading'>‚öñÔ∏è License</h2>

<p><strong>Eval</strong> is available under the Apache 2.0 licensing rules. See the <a href="https://github.com/tevelee/Eval/tree/master/LICENSE.txt">LICENSE</a> file for more information.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="https://tevelee.github.io" target="_blank" rel="external">Laszlo Teveli</a>. All rights reserved. (Last updated: 2019-06-14)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ‚ô™‚ô´ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
